{% extends "base.html" %}
{% block content %}

<h1 class="mb-4">Calificaciones tributarias</h1>

<!-- FORMULARIO DE FILTRO -->
<form method="get" class="row g-3 mb-4">

    <div class="col-md-3">
        <label class="form-label">Año</label>
        {{ form.anio_tributario }}
    </div>

    <div class="col-md-3">
        <label class="form-label">Corredor</label>
        {{ form.corredor }}
    </div>

    <div class="col-md-3">
        <label class="form-label">Emisor</label>
        {{ form.emisor }}
    </div>

    <div class="col-md-3">
        <label class="form-label">Estado</label>
        {{ form.estado }}
    </div>

    <div class="col-md-12 text-end">
        <button type="submit" class="btn btn-primary">
            Aplicar filtros
        </button>
    </div>

</form>


<!-- CABECERA CON BOTONES -->
<div class="d-flex justify-content-between align-items-center mb-2">

    <h4>Resultados</h4>

    <div>
        <a href="{% url 'crear_calificacion' %}" class="btn btn-success btn-sm">
            Nueva calificación
        </a>

        <!-- Mantiene filtros activos -->
        <a href="?{{ request.GET.urlencode }}&export=excel" class="btn btn-outline-secondary btn-sm">
            Exportar Excel
        </a>
    </div>

</div>


<!-- TABLA DE RESULTADOS -->
<div class="table-responsive">
<table class="table table-striped table-bordered align-middle">

    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Emisor</th>
            <th>Corredor</th>
            <th>Año</th>
            <th>Monto</th>
            <th>Factor</th>
            <th>Monto calificado</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>

    <tbody>
        {% for c in calificaciones %}
        <tr>
            <td>{{ c.id }}</td>
            <td>{{ c.emisor }}</td>
            <td>{{ c.corredor }}</td>
            <td>{{ c.anio_tributario }}</td>
            <td>$ {{ c.monto|floatformat:2 }}</td>
            <td>{{ c.factor }}</td>
            <td>$ {{ c.monto_calificado|floatformat:2 }}</td>
            
            <td>
                {% if c.estado == "APROBADO" %}
                    <span class="badge bg-success">{{ c.estado }}</span>
                {% elif c.estado == "RECHAZADO" %}
                    <span class="badge bg-danger">{{ c.estado }}</span>
                {% elif c.estado == "PENDIENTE" %}
                    <span class="badge bg-warning text-dark">{{ c.estado }}</span>
                {% else %}
                    <span class="badge bg-secondary">{{ c.estado }}</span>
                {% endif %}
            </td>

            <td>
                <a href="{% url 'editar_calificacion' c.id %}" class="btn btn-sm btn-outline-primary">Editar</a>
                <a href="{% url 'eliminar_calificacion' c.id %}" class="btn btn-sm btn-outline-danger">Eliminar</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="9" class="text-center text-muted">
                No se encontraron resultados.
            </td>
        </tr>
        {% endfor %}
    </tbody>

</table>
</div>



{% endblock %}
