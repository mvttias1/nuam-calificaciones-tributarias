<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Plataforma NUAM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background-color: #f5f7fb; }
    footer { background-color: #0b2f53; color: white; }

    .navbar { background-color: #0b2f53; }
    .navbar-brand, .nav-link, .navbar-text { color: white !important; }

    .nav-link.active {
      font-weight: 700;
      text-decoration: underline;
      text-underline-offset: 6px;
    }

    /* Evita que se corten feo los textos del men√∫ en desktop */
    @media (min-width: 992px) {
      .navbar .nav-link { white-space: nowrap; }
    }

    /* √çcono hamburguesa visible en navbar oscuro */
    .navbar-dark .navbar-toggler { border-color: rgba(255,255,255,.35); }
    .navbar-dark .navbar-toggler-icon {
      filter: invert(1) grayscale(100%);
    }
  </style>
</head>

<body>

<nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container-fluid">

    {% if request.user.is_authenticated %}
      {% with rol=request.user.rol.nombre|default:'' %}
        {% if rol == "Administrador" or rol == "Gerente" %}
          <a class="navbar-brand fw-bold" href="{% url 'dashboard' %}">NUAM</a>
        {% else %}
          <a class="navbar-brand fw-bold" href="{% url 'listar_calificaciones' %}">NUAM</a>
        {% endif %}
      {% endwith %}
    {% else %}
      <a class="navbar-brand fw-bold" href="{% url 'login' %}">NUAM</a>
    {% endif %}

    <!-- Bot√≥n hamburguesa -->
    <button class="navbar-toggler" type="button"
            data-bs-toggle="collapse" data-bs-target="#menu"
            aria-controls="menu" aria-expanded="false" aria-label="Men√∫">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="menu">

      <!-- Men√∫ izquierdo -->
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">

        {% if request.user.is_authenticated %}
          {% with rol=request.user.rol.nombre|default:'' %}

            <!-- Dashboard: Administrador y Gerente -->
            {% if rol == "Administrador" or rol == "Gerente" %}
              <li class="nav-item">
                <a class="nav-link {% if request.path == '/dashboard/' %}active{% endif %}"
                   href="{% url 'dashboard' %}">
                  Dashboard
                </a>
              </li>
            {% endif %}

            <!-- Calificaciones: todos los roles -->
            {% if rol == "Administrador" or rol == "Analista" or rol == "Corredor" or rol == "Auditor" or rol == "Gerente" %}
              <li class="nav-item">
                <a class="nav-link {% if 'calificaciones' in request.path %}active{% endif %}"
                   href="{% url 'listar_calificaciones' %}">
                  Calificaciones
                </a>
              </li>
            {% endif %}

            <!-- Subir archivo: Corredor, Analista, Administrador -->
            {% if rol == "Administrador" or rol == "Analista" or rol == "Corredor" %}
              <li class="nav-item">
                <a class="nav-link {% if 'subir-archivo' in request.path %}active{% endif %}"
                   href="{% url 'subir_archivo' %}">
                  Subir archivo
                </a>
              </li>
            {% endif %}

            <!-- Subir PDF -->
            {% if rol == "Administrador" or rol == "Analista" or rol == "Corredor" %}
              <li class="nav-item">
                <a class="nav-link {% if 'subir-pdf' in request.path %}active{% endif %}"
                   href="{% url 'subir_pdf' %}">
                  Subir PDF
                </a>
              </li>
            {% endif %}

            <!-- Bit√°cora: Administrador y Auditor -->
            {% if rol == "Administrador" or rol == "Auditor" %}
              <li class="nav-item">
                <a class="nav-link {% if 'bitacora' in request.path %}active{% endif %}"
                   href="{% url 'ver_bitacora' %}">
                  Bit√°cora
                </a>
              </li>
            {% endif %}

            <!-- Reportes: Admin / Auditor -->
            {% if rol == "Administrador" or rol == "Auditor" %}
              <li class="nav-item">
                <a class="nav-link {% if 'reportes' in request.path %}active{% endif %}"
                   href="{% url 'reporte_calificaciones' %}">
                  Reportes
                </a>
              </li>
            {% endif %}

            <!-- Notificaciones: TODOS -->
            {% if rol == "Administrador" or rol == "Analista" or rol == "Corredor" or rol == "Auditor" or rol == "Gerente" %}
              <li class="nav-item">
                <a class="nav-link {% if 'notificaciones' in request.path %}active{% endif %}"
                   href="{% url 'ver_notificaciones' %}">
                  Notificaciones
                </a>
              </li>
            {% endif %}

            <!-- Informe de gesti√≥n PDF: SOLO ADMIN -->
            {% if rol == "Administrador" %}
              <li class="nav-item">
                <a class="nav-link {% if 'informe-gestion' in request.path %}active{% endif %}"
                   href="{% url 'informe_gestion_pdf' %}">
                  Informe gesti√≥n (PDF)
                </a>
              </li>
            {% endif %}

          {% endwith %}
        {% endif %}

      </ul>

      <!-- Lado derecho -->
      {% if request.user.is_authenticated %}
        <div class="d-flex align-items-center gap-3">
          <span class="navbar-text">
            üë§ {{ request.user.username }}
            {% if request.user.rol %}
              <small class="ms-1">({{ request.user.rol.nombre }})</small>
            {% endif %}
          </span>

          <form method="post" action="{% url 'logout' %}" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-light btn-sm">
              Cerrar sesi√≥n
            </button>
          </form>
        </div>
      {% else %}
        <a href="{% url 'login' %}" class="btn btn-outline-light btn-sm">
          Iniciar sesi√≥n
        </a>
      {% endif %}

    </div>
  </div>
</nav>

<main class="container my-4">
  {% block content %}{% endblock %}
</main>

<footer class="text-center py-3 mt-4">
  Plataforma NUAM ‚Ä¢ Sistema de Calificaciones Tributarias ¬© 2025
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
